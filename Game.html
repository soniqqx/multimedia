<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>MaiunV2.html</title>
    <script type="text/javascript" src="simpleGame.js"></script>
    <script type="text/javascript" src="Lib.js"></script>
    <script type="text/javascript">
      var game;
      var background;
      var character;
      var trees;
      var door;
      var numTrees = 15;
      let key; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏∏‡∏ç‡πÅ‡∏à
      let hasKey = false;
      let keyCount = 0; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ
      let keyDisplay; // Element ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡∏ó‡∏µ‡πà UI
      var timer;
      var mon;
      var water;
      var mon2;
      var mon3;
      var tent;
      var fire;
      var doorFake;

      function setupObstacles() {
        trees = [];
        let obstacleImages = [
          "Tree.png",
          "Grass.png",
          "Stone.png",
          "Bush_blue_flowers3.png",
          // "tree2.png",
          "111.png",
          // "Bush_red_flowers1.png",
          // "Fern1_1.png",
        ];

        for (let i = 0; i < numTrees; i++) {
          let randomImage =
            obstacleImages[Math.floor(Math.random() * obstacleImages.length)];
          trees[i] = new Obstacle(randomImage, trees);
        }
        placeKey();
        createKeyDisplay(); // ‡∏™‡∏£‡πâ‡∏≤‡∏á UI ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏∏‡∏ç‡πÅ‡∏à
      }

      var hasCollided = false; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏ô

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ï‡πà‡∏≤‡∏á ‡πÜ ‡πÉ‡∏ô‡πÄ‡∏Å‡∏°
      function updateObject() {
        for (i = 0; i < numTrees; i++) {
          let distance = trees[i].distanceTo(character); // ‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Å‡∏±‡∏ö‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ
          if (gameOver) return;
          if (!hasCollided && distance < 45) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏ä‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô
            console.log("Collision detected!");
            // trees[i].hide(); // ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏ä‡∏ô
            hasCollided = true; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ä‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ã‡πâ‡∏≥
            character.setSpeed(0); // ‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
            character.pauseAnimation(); // ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
            gameOver = false;
            // alert("You lose!"); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡πÅ‡∏û‡πâ

            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            setTimeout(function () {
              resetGame2(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            }, 1000); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
          }

          trees[i].update(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ
        }

        checkKeyCollision(); // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏Å‡∏±‡∏ö‡∏Å‡∏∏‡∏ç‡πÅ‡∏à
        checkDoorCollision(); // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏Å‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ï‡∏π
      }
      function updateObjectOLD() {
        for (let i = 0; i < numTrees; i++) {
          let distance = trees[i].distanceTo(character); // ‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Å‡∏±‡∏ö Object
          if (gameOver) return;
          if (!hasCollided && distance < 45) {
            console.log("Collision detected!");
            character.setSpeed(0); // ‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
            character.pauseAnimation();
            hasCollided = true; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ä‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ã‡πâ‡∏≥
            gameOver = true;
            blinkCharacter(() => {
              resetGame2(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
              // window.reload();
            });

            return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ä‡∏ô
          }

          trees[i].update(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Object ‡πÉ‡∏´‡πâ‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏°
        }
        checkKeyCollision();
        checkDoorCollision();
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö
      function blinkCharacter(callback) {
        let count = 0;
        let blinkInterval = setInterval(() => {
          character.visible = !character.visible; // ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
          count++;

          if (count >= 4) {
            // ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏ó‡∏∏‡∏Å 150ms)
            clearInterval(blinkInterval);
            character.visible = true; // ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏Å‡∏ï‡∏¥
            setTimeout(callback, 300); // ‡∏£‡∏≠ 300ms ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Å‡∏°
          }
        }, 150);
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
      function restartGame() {
        console.log("Restarting game...");
        score = 0;
        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
        character.setPosition(50, game.height / 2);
        character.setSpeed(0);
        character.pauseAnimation();
        hasKey = false;
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Object ‡πÉ‡∏´‡πâ‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà
        for (let i = 0; i < numTrees; i++) {
          trees[i].setVisible(true);
        }
        game.start(); // ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
      }

      function placeKey() {
        if (key) {
          key.hide(); // ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡πÄ‡∏Å‡πà‡∏≤
        }

        let keyPlaced = false;
        let padding = 50; // ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏≠‡∏ö

        while (!keyPlaced) {
          let x = Math.random() * game.canvas.width;
          let y = Math.random() * game.canvas.height;

          // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏Å‡∏Ç‡∏≠‡∏ö
          x = Math.max(padding, Math.min(x, game.canvas.width - padding));
          y = Math.max(padding, Math.min(y, game.canvas.height - padding));

          let overlap = trees.some((tree) => tree.distanceTo({ x, y }) < 50);
          let tooCloseToCharacter = character.distanceTo({ x, y }) < 300;
          let tooCloseToDoor = door.distanceTo({ x, y }) < 100;

          if (!overlap && !tooCloseToCharacter && !tooCloseToDoor) {
            key = new Sprite(game, "key.png", 60, 40);
            key.setSpeed(0);
            key.setPosition(x, y);
            keyPlaced = true;
          }
        }
      }

      function checkKeyCollision() {
        if (!hasKey && character.distanceTo(key) < 40) {
          hasKey = true;
          keyCount += 1;
          console.log("‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡πÑ‡∏î‡πâ!");
          // alert("‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡πÑ‡∏î‡πâ!");
          key.hide(); // ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ
          updateKeyDisplay();
        }
      }

      let doorAlertShown = false; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á alert

      function checkDoorCollision() {
        if (character.distanceTo(door) < 70) {
          if (hasKey) {
            door.open(); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡πÄ‡∏õ‡∏¥‡∏î
            console.log("‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ!");

            // **‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ó‡∏±‡∏ô‡∏ó‡∏µ**
            character.setSpeed(0);
            character.pauseAnimation();

            // ‡∏£‡∏≠ 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            setTimeout(() => {
              nextLevel(); // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
            }, 1000);
          } else if (!doorAlertShown) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÅ‡∏™‡∏î‡∏á alert
            console.log("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏∏‡∏ç‡πÅ‡∏à!");
            alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏∏‡∏ç‡πÅ‡∏à!");
            doorAlertShown = true; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ alert ‡πÄ‡∏Ñ‡∏¢‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
          }
        } else {
          doorAlertShown = false; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á alert ‡πÑ‡∏î‡πâ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏ï‡∏π
        }
      }

      function nextLevel() {
        console.log("‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ...");
        window.location.href = "Treasure2.html"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        setupObstacles(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        character.setPosition(50, game.height / 2); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
        keyCount = 0; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏∏‡∏ç‡πÅ‡∏à
        updateKeyDisplay(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏Å‡∏∏‡∏ç‡πÅ‡∏à
      }
      function resetGame() {
        score = 0;
        character.setPosition(50, game.height / 2);
        character.setSpeed(0);
        character.pauseAnimation();
        character.setCurrentCycle("down");
        hasKey = false;
        // setupKey(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏∏‡∏ç‡πÅ‡∏à
        updateKeyDisplay();
        setupObstacles();
      }
      function resetGame2() {
        hasCollided = false; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏ô
        gameOver = false;
        character.resetAnimation();
        character.setPosition(50, game.height / 2); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
        character.setSpeed(0); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
        character.pauseAnimation(); // ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡πÉ‡∏´‡∏°‡πà
        hasKey = false;
        keyCount = 0;
        placeKey(); // ‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡πÉ‡∏´‡∏°‡πà
        updateKeyDisplay();
      }

      function createKeyDisplay() {
        keyDisplay = document.createElement("div");
        keyDisplay.style.position = "absolute";
        keyDisplay.style.top = "10px";
        keyDisplay.style.left = "10px";
        keyDisplay.style.fontSize = "20px";
        keyDisplay.style.color = "white";
        keyDisplay.style.fontWeight = "bold";
        keyDisplay.innerHTML = "üîë x0"; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 0
        document.body.appendChild(keyDisplay);
      }

      // üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏∏‡∏ç‡πÅ‡∏à‡πÑ‡∏î‡πâ
      function updateKeyDisplay() {
        keyDisplay.innerHTML = `üîë x${keyCount}`;
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ß‡∏≤‡∏î‡πÄ‡∏ß‡∏•‡∏≤
      function drawTime(elapsedTime) {
        var ctx = game.canvas.getContext("2d"); // ‡πÑ‡∏î‡πâ context ‡∏Ç‡∏≠‡∏á canvas

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î
        ctx.font = "30px Arial"; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î
        ctx.fillStyle = "white"; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß
        ctx.textAlign = "right"; // ‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤
        ctx.textBaseline = "top"; // ‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô

        // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÉ‡∏ô‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô
        ctx.fillText(
          "‡πÄ‡∏ß‡∏•‡∏≤: " + elapsedTime.toFixed(2) + " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ",
          game.canvas.width - 20, // ‡∏≠‡∏¢‡∏π‡πà‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏ß‡∏≤‡∏Ç‡∏≠‡∏á canvas
          20 // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Y ‡∏ó‡∏µ‡πà 20px ‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
        );
      }
      function showDialog(message, isWin) {
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á dialog element
        const dialog = document.createElement("div");
        dialog.style.position = "fixed";
        dialog.style.top = "50%";
        dialog.style.left = "50%";
        dialog.style.transform = "translate(-50%, -50%)";
        dialog.style.background = "white";
        dialog.style.padding = "20px";
        dialog.style.border = "2px solid black";
        dialog.style.textAlign = "center";
        dialog.style.zIndex = "1000";

        const text = document.createElement("p");
        text.innerText = message;
        dialog.appendChild(text);

        const button = document.createElement("button");
        button.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà";
        button.style.marginTop = "10px";
        button.onclick = () => {
          // ‡πÉ‡∏ä‡πâ setTimeout ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
          setTimeout(() => {
            location.reload();
          }, 500); // ‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Dialog ‡∏õ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô
        };

        dialog.appendChild(button);
        document.body.appendChild(dialog);
      }

      function init() {
        game = new Scene();
        timer = new Timer();
        timer.reset();
        background = new Sprite(game, "bg.png", 800, 600);
        background.setSpeed(0, 0);
        background.setPosition(400, 300);
        character = new Sprite(game, "Boy.png", 256, 256);
        character.loadAnimation(256, 256, 64, 64);
        character.generateAnimationCycles();
        character.renameCycles(new Array("down", "left", "right", "up"));
        character.setAnimationSpeed(300);
        character.setBoundAction(STOP);

        mon = new Sprite(game, "Attack_2.png", 256, 256);
        mon.loadAnimation(512, 128, 128, 128);
        mon.generateAnimationCycles(SINGLE_ROW, 4); // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß 4 ‡πÄ‡∏ü‡∏£‡∏°
        mon.renameCycles(["attack"]);
        mon.setCurrentCycle("attack");
        mon.setSpeed(0);
        mon.setAnimationSpeed(500);
        mon.playAnimation(true);

        mon2 = new Sprite(game, "Jump.png", 256, 256);
        mon2.loadAnimation(1664, 128, 128, 128);
        mon2.generateAnimationCycles(SINGLE_ROW, 13); // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß 4 ‡πÄ‡∏ü‡∏£‡∏°
        mon2.renameCycles(["jump"]);
        mon2.setCurrentCycle("jump");
        mon2.setSpeed(0);
        mon2.setAnimationSpeed(700);
        mon2.playAnimation(true);

        mon3 = new Sprite(game, "Slime3_Attack_full.png", 576, 60);
        mon3.loadAnimation(576, 60, 64, 60);
        mon3.generateAnimationCycles(SINGLE_ROW, 9); // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß 4 ‡πÄ‡∏ü‡∏£‡∏°
        mon3.renameCycles(["bomb"]);
        mon3.setCurrentCycle("bomb");
        mon3.setSpeed(0);
        mon3.setAnimationSpeed(1000);
        mon3.playAnimation(true);

        water = new Sprite(game, "water.gif", 200, 200);
        water.setSpeed(0);

        tent = new Sprite(game, "1.png", 90, 80);
        tent.setSpeed(0);

        fire = new Sprite(game, "treasureClose.png", 60, 60);
        fire.setSpeed(0);

        doorFake = new Sprite(game, "doorFake.png", 160, 100);
        doorFake.loadAnimation(160, 26, 32, 26);
        doorFake.generateAnimationCycles(SINGLE_ROW, 5); // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß 4 ‡πÄ‡∏ü‡∏£‡∏°
        doorFake.renameCycles(["door"]);
        doorFake.setCurrentCycle("door");
        doorFake.setSpeed(0);
        doorFake.setAnimationSpeed(700);
        doorFake.playAnimation(true);

        // var elapsedTime = timer.getElapsedTime(); // ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
        // drawTime(elapsedTime);
        //start paused
        character.setPosition(50, game.height / 2);
        mon.setPosition(300, 400);
        mon2.setPosition(300, 500);
        mon3.setPosition(530, 580);
        water.setPosition(400, 550);
        tent.setPosition(600, 550);
        fire.setPosition(530, 530);
        doorFake.setPosition(100, 100);
        character.setSpeed(0);
        character.pauseAnimation();
        character.setCurrentCycle("down");

        document.addEventListener("keydown", function (event) {
          keysDown[event.key] = true;
        });

        document.addEventListener("keyup", function (event) {
          delete keysDown[event.key];
        });
        door = new Door();
        // setupKey();
        setupObstacles();
        game.start();
      } // end init

      function update() {
        game.clear();
        checkKeys();
        background.update();
        character.update();
        // mon.update();
        key.update();
        door.update();
        water.update();
        // mon2.update();
        // mon3.update();
        tent.update();
        fire.update();
        // doorFake.update();
        updateObjectOLD();
        // var elapsedTime = timer.getElapsedTime();
        // if (elapsedTime >= 10) {
        //   // ‡∏´‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà

        //   character.setSpeed(0);
        //   character.pauseAnimation();
        //   // gameOver = true; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß

        //   showDialog("new game", false);
        //   // window.location.reload(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
        // } else {
        //   // ‡∏ß‡∏≤‡∏î‡πÄ‡∏ß‡∏•‡∏≤
        //   drawTime(elapsedTime);
        // }
      } // end update
    </script>
  </head>
  <body onload="init()"></body>
</html>
